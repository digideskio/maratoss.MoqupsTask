@using Moqups.Entities
@model IList<Moqups.Entities.User>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section head
{
    <link href="/Content/themes/base/jquery-ui.css" rel="stylesheet">
    <script src="/Scripts/jquery-ui-1.10.4.min.js"></script>

    <!-- Pick a theme, load the plugin & initialize plugin -->
    <link href="/Content/themes/sorter/theme.default.css" rel="stylesheet">
    <script src="/Scripts/jquery.tablesorter.min.js"></script>
    <script src="/Scripts/jquery.tablesorter.widgets.min.js"></script>
}

@section scripts
{
    <script type="text/javascript">
        $(function () {
            $('table').tablesorter({
                widgets: ['zebra', 'columns'],
                usNumberFormat: false,
                sortReset: true,
                sortRestart: true
            });

            //$("#dialog-message").dialog("close");
        });

        function openWindow(isEdit, userId) {
            var titleWindow = isEdit ? "Edit user" : "Add user";
            var dialogMessage = $("#dialog-message");
            $.ajax({
                type: "GET",
                url: '@Url.Action("DetailsUser", "Home")',
                data: ({ id: userId }),
                error: function (data) {
                    alert(data.responseText);
                },
                success: function (data) {
                    dialogMessage.html(data);
                    dialogMessage.dialog({
                        modal: true,
                        title: titleWindow,
                        width: 350
                    });

                    var cancelButton = $("#dialog-message").find("#cancelButton");
                    cancelButton.on("click", function() {
                        dialogMessage.dialog("close");
                    });
                }
            });
        }
    </script>
}

<input type="button" value="Add" onclick="openWindow(false, 0)" />

<div id="dialog-message">
</div>

<table class="tablesorter" id="myTable">
    <thead>
        <tr>
            <td>Firstname</td>
            <td>Lastname</td>
            <td>Status</td>
            <td>Pages</td>
            <td>Admin</td>
        </tr>
    </thead>
    <tbody>
        @foreach (User user in @Model)
        {
            <tr ondblclick="openWindow(true, @user.Id)">
                <td>@user.Firstname</td>
                <td>@user.Lastname</td>
                <td>@user.Status</td>
                <td>@(user.Pages.Aggregate(string.Empty, (accString, p2) => accString + "/" + p2.Name))</td>
                <td><input type="checkbox" checked="@user.IsAdmin" disabled="disabled"/></td>
            </tr>
        }
    </tbody>
</table>
